@if (user) {
  <div class="dashboard-header">
    <h4>{{ 'COMMON.WELCOME' | translate }}{{ user.name }}</h4>

    <div class="preview-section">
      <h6>{{ 'DASHBOARD.BALANCE' | translate }}</h6>
    </div>
  </div>

  <div class="dashboard-content">
    @if (incomingTargets.length) {
      <mat-card appearance="outlined">
        <mat-card-content>
          <cdk-accordion>
            <cdk-accordion-item #accordionItem="cdkAccordionItem" class="preview-section">
              <div class="previev-header">
                <h6>{{ 'DASHBOARD.INCOMING_TARGETS' | translate }}</h6>
                <button
                  mat-icon-button
                  (click)="accordionItem.toggle()"
                  [attr.aria-expanded]="accordionItem.expanded">
                  <mat-icon
                    class="accordion-icon"
                    [ngClass]="{ 'accordion-icon--expanded': accordionItem.expanded }"
                    >keyboard_arrow_down</mat-icon
                  >
                </button>
              </div>
              @if (accordionItem.expanded) {
                @for (goal of incomingTargets; track $index) {
                  <ng-container
                    [ngTemplateOutlet]="goalPreview"
                    [ngTemplateOutletContext]="{ $implicit: goal }"></ng-container>
                }
              }
            </cdk-accordion-item>
          </cdk-accordion>
        </mat-card-content>
      </mat-card>
    }
    @if (mostFulfilledTargets.length) {
      <mat-card appearance="outlined">
        <mat-card-content>
          <cdk-accordion>
            <cdk-accordion-item #accordionItem="cdkAccordionItem" class="preview-section">
              <div class="previev-header">
                <h6>{{ 'DASHBOARD.FULFILLED_TARGETS' | translate }}</h6>
                <button
                  mat-icon-button
                  (click)="accordionItem.toggle()"
                  [attr.aria-expanded]="accordionItem.expanded">
                  <mat-icon
                    class="accordion-icon"
                    [ngClass]="{ 'accordion-icon--expanded': accordionItem.expanded }"
                    >keyboard_arrow_down</mat-icon
                  >
                </button>
              </div>
              @if (accordionItem.expanded) {
                @for (goal of mostFulfilledTargets; track $index) {
                  <ng-container
                    [ngTemplateOutlet]="goalPreview"
                    [ngTemplateOutletContext]="{ $implicit: goal }"></ng-container>
                }
              }
            </cdk-accordion-item>
          </cdk-accordion>
        </mat-card-content>
      </mat-card>
    }

    <mat-card appearance="outlined">
      <mat-card-content>
        <cdk-accordion>
          <cdk-accordion-item #accordionItem="cdkAccordionItem" class="preview-section">
            <div class="previev-header">
              <h6>{{ 'DASHBOARD.EXPENSES_BY_CATEGORY' | translate }}</h6>
              <button
                mat-icon-button
                (click)="accordionItem.toggle()"
                [attr.aria-expanded]="accordionItem.expanded">
                <mat-icon
                  class="accordion-icon"
                  [ngClass]="{ 'accordion-icon--expanded': accordionItem.expanded }"
                  >keyboard_arrow_down</mat-icon
                >
              </button>
            </div>
            @if (accordionItem.expanded) {
              <mat-form-field>
                <mat-label>{{ 'DASHBOARD.EXPENSES.START_DATE' | translate }}</mat-label>
                <input
                  matInput
                  [(ngModel)]="outcomeRange.startDate"
                  (ngModelChange)="this.preparePieData()" />
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              <mat-form-field>
                <mat-label>{{ 'DASHBOARD.EXPENSES.END_DATE' | translate }}</mat-label>
                <input
                  matInput
                  [(ngModel)]="outcomeRange.endDate"
                  (ngModelChange)="this.preparePieData()" />
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              @if (pieChartDatasets[0].data.length) {
                <canvas
                  baseChart
                  [type]="'pie'"
                  [datasets]="pieChartDatasets"
                  [labels]="pieChartLabels"
                  [options]="pieChartOptions"
                  [plugins]="[]"
                  [legend]="true">
                </canvas>
              } @else {
                {{ 'COMMON.NO_RESULT' | translate }}
              }
            }
          </cdk-accordion-item>
        </cdk-accordion>
      </mat-card-content>
    </mat-card>
  </div>
}

<ng-template #goalPreview let-goal>
  <mat-card appearance="outlined">
    <mat-card-content class="saving-goal-preview">
      <div class="saving-goal-preview__first-line">
        <mat-icon>track_changes</mat-icon>
        <div [matTooltip]="goal.targetTitle" class="text-ellipsis goal-name">
          {{ goal.targetTitle }}
        </div>
        <div class="progress-bar">
          <mat-progress-bar class="progress-bar__style" mode="determinate" [value]="goal.progress"
            >{{ goal.progress }}&#37;</mat-progress-bar
          >
          <span class="progress-bar__tooltip">{{ goal.progress }}&#37;</span>
        </div>
      </div>
      <div>{{ goal.targetDate | date }}</div>
    </mat-card-content>
  </mat-card>
</ng-template>
